# Epic 9 — Status Bubble and Context Menu UX

## Status
InProgress

## Story
**As a** user,
**I want** quick controls in a status bubble and context menu,
**so that** I can adjust mic/language and inspect polish without opening the hub.

## Acceptance Criteria
1. Status bubble shows recording state, audio level, mic, and language.
2. Mic selection dialog with volume indicator is available from bubble.
3. Context menu provides quick actions (paste last transcript, open settings, open polish diff).
4. Polish diff viewer shows before/after text and can auto-close safely.
5. All UX behaviors are gated by feature flags for safe rollout.
6. Bubble is non-intrusive (always-on-top).
7. Mic/language submenus do not close unintentionally when moving the cursor between parent and submenu (hover intent / safe gap handling).
8. Mic selection is consistent across status bubble, Settings, and Onboarding (single source of truth; no empty mic menus).
9. The dashboard/hub has a clear entry point to “Polish” (discoverability), without adding clutter to history row actions.

## Tasks / Subtasks
- [x] Add status bubble indicators and mic/language controls (AC: 1,2)
- [x] Implement context menu window and quick actions (AC: 3)
- [x] Implement polish diff viewer (AC: 4)
- [x] Gate new surfaces behind feature flags (AC: 5)
- [x] Ensure non-intrusive always-on-top behavior (AC: 6)
- [x] Fix submenu hover behavior (mic/language) so it doesn’t close in the “gap” (AC: 7)
- [x] Unify microphone selector data/source across bubble, settings, onboarding (AC: 8)
- [x] Add a dashboard entry point for Polish (e.g., section/card/button opening last diff) (AC: 9)

## Dev Notes
- Keep hub as deep management UI; bubble/menu should be lightweight.
- Use IPC domains for status events and polish events.
- Bubble should avoid stealing focus during dictation.

### Testing
- Manual: mic switch, language switch, paste last transcript, diff open/close.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-24 | v0.1 | New epic for bubble/menu UX | PO |
| 2026-01-25 | v0.2 | Removed click-through and repositioning requirements | PO |
| 2026-02-01 | v0.3 | Video review: submenu hover fix + polish discoverability + selector consistency | PM |
| 2026-02-01 | v0.4 | Hover-safe submenus, mic selector consistency, polish entry CTA | Dev |
| 2026-02-01 | v0.5 | Fix cross-window mic selection fallback + cached list | Dev |
| 2026-02-01 | v0.6 | Prefer widget mic cache for dashboard selection | Dev |
| 2026-02-01 | v0.7 | Prevent blank mic selection when id mismatch | Dev |
| 2026-02-01 | v0.8 | Sanitize select values to avoid blank dropdowns | Dev |

## Dev Agent Record
### Agent Model Used
GPT-5 (Codex CLI)

### Debug Log References
- node test-core.js
- node --check renderer.js
- node --check dashboard.js

### Completion Notes List
- Added context menu actions, mic/language submenus, and polish diff view.
- Kept the bubble non-intrusive and always-on-top.
- Wired feature-flag gating for status bubble and context menu.
- Added hover grace for submenu gaps and synced mic lists across widget/settings/onboarding.
- Added a dashboard polish entry button gated by feature flags.
- Prevented stored mic fallbacks from poisoning cached mic lists; prefer label matching when dashboards reopen.
- Dashboard now prefers widget mic cache so selections persist when the dashboard is closed.
- Clear invalid mic selection ids so the dropdown never renders blank.
- Added select sanitation to prevent blank dropdowns (mic/local models).

### File List
- index.html
- renderer.js
- main.js
- dashboard.html
- dashboard.js
- preload.js

## QA Results
