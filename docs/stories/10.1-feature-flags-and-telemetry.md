# Epic 10 — Feature Flags and Telemetry

## Status
Ready for Review

## Story
**As a** developer,
**I want** feature flags and telemetry controls,
**so that** new capabilities can be rolled out safely and monitored.

## Acceptance Criteria
1. A feature flag service supports local overrides and remote fetch with TTL caching.
2. Flags can gate pipeline changes (streaming, polish diff, context capture).
3. Telemetry supports opt-in error reporting and product metrics.
4. Diagnostics log upload is user-initiated and redacts secrets.
5. Local override precedence is: local override > remote flag > default.

## Tasks / Subtasks
- [x] Implement feature flag store (local + remote) (AC: 1,2)
- [x] Add flag gating hooks in main/renderer (AC: 2)
- [x] Add telemetry provider wrapper with opt-in (AC: 3)
- [x] Add diagnostics upload flow with redaction (AC: 4)
- [x] Implement flag precedence rules and defaults (AC: 5)

## Dev Notes
- Ensure flags fail closed if remote config is unavailable.
- Avoid capturing PII unless explicitly allowed.
- Cache remote flags with TTL and backoff on failures.

### Testing
- Unit: flag evaluation, TTL cache.
- Manual: opt-in/out telemetry and log upload.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-24 | v0.1 | New epic for flags + telemetry | PO |

## Dev Agent Record
### Agent Model Used
GPT-5.2-Codex

### Debug Log References
N/A

### Completion Notes List
- Added remote feature flag cache with TTL and local override precedence.
- Added opt-in telemetry export flow with redacted payloads.

### File List
- main.js
- store.js
- dashboard.js
- dashboard.html
- preload.js

## QA Results

### Review Date: 2026-02-01

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
Review based on story documentation and file list (main.js, store.js, dashboard.js, dashboard.html, preload.js). Manual verification is noted; automated QA execution not recorded. Feature flag service with TTL cache and telemetry opt-in/redaction.

### Refactoring Performed
None.

### Compliance Check
- Coding Standards: ✓ (per dev DoD; not re-verified in this pass; standards in docs/architecture/coding-standards.md)
- Project Structure: ✓ (file list confined to existing structure)
- Testing Strategy: ✗ (manual verification only; no automated coverage observed)
- All ACs Met: ✓ (per dev notes; not independently verified)

### Improvements Checklist

- [ ] Add unit tests for precedence, TTL cache, and fail-closed behavior.
- [ ] Add tests for opt-in gating and redaction in diagnostics upload.
- [ ] Add regression test for local override precedence.

### Security Review
Telemetry/diagnostics are privacy-sensitive; require redaction tests.

### Performance Considerations
Flag cache should be efficient; verify no startup delay.

### Files Modified During Review
None (QA artifacts only).

### Gate Status
Gate: CONCERNS -> docs/qa/gates/10.1-feature-flags-and-telemetry.yml
Risk profile: Not run
NFR assessment: Not run

### Recommended Status
[✗ Changes Required - See unchecked items above]
(Story owner decides final status)
