# Story 1.5: improve-performance-hot-paths

## Status
Approved

## Story
**As a** user,
**I want** faster processing for long recordings and large history lists,
**so that** the app remains responsive over time.

**Epic alignment:** Supports Epic 1 goal to secure and stabilize the codebase.
**Dependencies:** None.

## Acceptance Criteria
1. Audio IPC sends ArrayBuffer directly without Array-from JSON conversion.
2. SQLite indexes are added for history/notes/dictionary/styles sorting and purge queries.
3. Settings writes avoid bulk upserts when only one key changes.
4. Dictionary lookups are cached or optimized without altering results.

## Tasks / Subtasks
- [ ] Task 1: Optimize audio IPC payload (AC: 1)
  - [ ] Update `renderer.js` to send ArrayBuffer directly over IPC
  - [ ] Update `main.js` to consume raw ArrayBuffer without JSON conversion
  - Ref: `docs/architecture/architecture.md#Source Tree`, `docs/architecture/architecture.md#Integration Approach`
- [ ] Task 2: Add SQLite indexes for hot queries (AC: 2)
  - [ ] Add `CREATE INDEX IF NOT EXISTS` for history/notes/dictionary/styles ordering and purge queries
  - [ ] Keep schema changes additive and non-destructive
  - Ref: `docs/architecture/architecture.md#Compatibility Requirements`, `docs/architecture/architecture.md#Data Models and Schema Changes`
- [ ] Task 3: Reduce settings write amplification (AC: 3)
  - [ ] Update settings writes to avoid bulk upserts when only one key changes
  - [ ] Preserve current settings behavior and defaults
  - Ref: `docs/architecture/architecture.md#Compatibility Requirements`, `docs/architecture/architecture.md#Integration Approach`
- [ ] Task 4: Optimize dictionary lookups (AC: 4)
  - [ ] Cache dictionary entries in memory and invalidate on upsert/delete
  - [ ] Preserve existing dictionary behavior and output
  - Ref: `docs/architecture/architecture.md#Compatibility Requirements`, `docs/architecture/architecture.md#Integration Approach`
- [ ] Task 5: Manual verification (AC: 1â€“4)
  - [ ] Long recordings process faster without UI regressions
  - [ ] History/notes lists remain responsive as data grows
  - [ ] Settings changes still persist correctly
  - [ ] Dictionary application results are unchanged
  - Ref: `docs/architecture/architecture.md#Testing Strategy`

## Dev Notes

**Relevant Source Tree**
- Core files live at repo root; renderer/main/store are `renderer.js`, `main.js`, `store.js`.
  [Source: `docs/architecture/architecture.md#Source Tree`]

**Existing Patterns / Constraints**
- Preserve existing UI behavior and IPC channels.
  [Source: `docs/architecture/architecture.md#Compatibility Requirements`]
- No destructive schema changes to local SQLite.
  [Source: `docs/architecture/architecture.md#Compatibility Requirements`]
- Keep flat root structure; no new folders.
  [Source: `docs/architecture/architecture.md#Source Tree`]

**Data/Schema Guidance**
- No new tables are defined; any DB changes must be additive.
  [Source: `docs/architecture/architecture.md#Data Models and Schema Changes`]

### Testing
- No automated test harness exists; use manual validation and runtime logs.
  [Source: `docs/architecture/architecture.md#Testing Strategy`]

Manual verification to document:
- Long recordings process faster; no UI regressions.
- History/notes lists remain responsive as data grows.
- Settings changes still persist correctly.
- Dictionary application results are unchanged.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-24 | v0.1 | Draft story created from Epic 1 | Bob |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
