# Epic 5 - Adaptive Transcript Formatting v1

## Status
Ready for Review

## Story
**As a** user,
**I want** my dictation to adapt in tone and formatting based on the active app profile,
**so that** the output matches the context without extra editing.

## Acceptance Criteria
1. The app applies per-app profile rules to punctuation, line breaks, and structure before delivery.
2. Tone presets (e.g., concise vs. conversational) are supported and influence the final text.
3. The adaptation step is deterministic and does not change meaning or remove content.
4. The user can preview or test a profile with sample input in settings.
5. If a profile is missing or disabled, the default formatting pipeline is used.
6. Optional style detection can suggest a profile, but never applies without explicit user choice.
7. The adaptive formatting step runs before dictionary and snippets, and after transcription post-process.

## Tasks / Subtasks
- [x] Add formatting/tone parameters to the profile schema (AC: 1,2)
- [x] Implement adaptive formatting step in the pipeline (AC: 1,3,5)
- [x] Add a preview/test UI for profiles (AC: 4)
- [x] Ensure delivery output uses the adapted text (AC: 1)
- [x] Add optional style detection hints with explicit user selection (AC: 6)
- [x] Enforce pipeline ordering for formatting vs dictionary/snippets (AC: 7)

## Dev Notes
- Keep this v1 rule-based; avoid introducing model or network dependencies.
- Log profile usage for debugging when enabled.
- Suggested order: post-process -> adaptive formatting -> snippets -> dictionary -> persist/deliver.

### Testing
- Manual: dictation in two apps produces different formatting based on profiles.
- Manual: profile disabled or missing uses default formatting.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-20 | v0.1 | Story created from global PRD Epic 5 shard plan | PO |

## Dev Agent Record
### Agent Model Used
GPT-5

### Debug Log References
N/A

### Completion Notes List
- Profils contextuels avec tone/formatting appliqués avant snippets/dictionnaire.
- Prévisualisation de profil et suggestion sans auto-application.

### File List
- main.js
- dashboard.html
- dashboard.js

## QA Results

### Review Date: 2026-02-01

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
Review based on story documentation and file list (main.js, dashboard.html, dashboard.js). Manual verification is noted; automated QA execution not recorded. Adaptive formatting based on app profiles and fallbacks.

### Refactoring Performed
None.

### Compliance Check
- Coding Standards: ✓ (per dev DoD; not re-verified in this pass; standards in docs/architecture/coding-standards.md)
- Project Structure: ✓ (file list confined to existing structure)
- Testing Strategy: ✗ (manual verification only; no automated coverage observed)
- All ACs Met: ✓ (per dev notes; not independently verified)

### Improvements Checklist

- [ ] Add tests for profile matching/fallback and formatting rules.
- [ ] Add regression coverage for multi-app formatting consistency.

### Security Review
No security-sensitive changes.

### Performance Considerations
Formatting overhead should be minimal; verify on long dictations.

### Files Modified During Review
None (QA artifacts only).

### Gate Status
Gate: CONCERNS -> docs/qa/gates/5.1-adaptive-transcript-formatting-v1.yml
Risk profile: Not run
NFR assessment: Not run

### Recommended Status
[✗ Changes Required - See unchecked items above]
(Story owner decides final status)
