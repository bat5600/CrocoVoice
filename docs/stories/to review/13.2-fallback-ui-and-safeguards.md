# Epic 13 — Fallback UI and Safeguards

## Status
Ready for Review

## Story
**As a** user,
**I want** clear UI indicators and safe fallback behavior,
**so that** I understand when local inference is active and can trust results.

## Acceptance Criteria
1. The UI indicates which inference path is active (local vs cloud).
2. If local inference fails or is unavailable, the system falls back to cloud ASR (if allowed) without data loss.
3. CPU safeguards are enforced (max duration, throttling) to prevent app freezes.
4. Users can switch off local inference and return to cloud-only mode.

## Tasks / Subtasks
- [x] Add UI indicator for inference path (AC: 1)
- [x] Implement fallback logic and error handling (AC: 2)
- [x] Add CPU/time safeguards for local inference (AC: 3)
- [x] Add user-facing toggle for local inference (AC: 4)

## Dev Notes
- Safeguards should favor stability over accuracy (abort local job if thresholds exceeded).
- Fallback should respect privacy settings (do not upload if cloud is disabled).

### Testing
- Manual: force local inference failure and verify fallback behavior.
- Manual: toggle local inference off and confirm cloud-only mode.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-25 | v0.1 | New story for fallback UI and safeguards | PO |

## Dev Agent Record
### Agent Model Used
GPT-5.2-Codex

### Debug Log References
N/A

### Completion Notes List
- Added inference path metrics in diagnostics and history for local/cloud visibility.
- Implemented safe fallback with timeouts and system load checks.

### File List
- main.js
- store.js
- dashboard.js
- dashboard.html

## QA Results

### Review Date: 2026-02-01

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
Review based on story documentation and file list (main.js, store.js, dashboard.js, dashboard.html). Manual verification is noted; automated QA execution not recorded. Fallback UI and safeguards for local inference.

### Refactoring Performed
None.

### Compliance Check
- Coding Standards: ✓ (per dev DoD; not re-verified in this pass; standards in docs/architecture/coding-standards.md)
- Project Structure: ✓ (file list confined to existing structure)
- Testing Strategy: ✗ (manual verification only; no automated coverage observed)
- All ACs Met: ✓ (per dev notes; not independently verified)

### Improvements Checklist

- [ ] Add tests for fallback triggers and safe-mode UI transitions.
- [ ] Add regression test for toggling local inference off/on.
- [ ] Add tests for retry/restore behavior.

### Security Review
No security-sensitive changes.

### Performance Considerations
No significant perf concerns noted.

### Files Modified During Review
None (QA artifacts only).

### Gate Status
Gate: CONCERNS -> docs/qa/gates/13.2-fallback-ui-and-safeguards.yml
Risk profile: Not run
NFR assessment: Not run

### Recommended Status
[✗ Changes Required - See unchecked items above]
(Story owner decides final status)
