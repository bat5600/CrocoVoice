# Epic 10 — Telemetry and Quality Metrics

## Status
Ready for Review

## Story
**As a** product owner,
**I want** quality metrics captured per dictation,
**so that** we can measure reliability and improve the pipeline.

## Acceptance Criteria
1. History stores e2e latency, network latency (if applicable), and fallback usage reason.
2. Divergence score between raw and formatted text is computed and stored.
3. Metrics are visible in a diagnostics or quality panel.
4. Telemetry export is opt-in and redacts sensitive content.
5. Metrics capture does not block dictation completion.

## Tasks / Subtasks
- [x] Add metric fields to history schema (AC: 1,2)
- [x] Compute divergence score after formatting (AC: 2)
- [x] Add quality metrics UI in diagnostics or hub (AC: 3)
- [x] Add opt-in telemetry export with redaction (AC: 4)
- [x] Ensure metrics capture is async and non-blocking (AC: 5)

## Dev Notes
- Avoid storing raw audio unless explicitly enabled.
- Keep metric computation lightweight to avoid latency.
- Recommended metric fields: `latency_ms`, `network_latency_ms`, `fallback_reason`, `divergence_score`.

### Testing
- Unit: divergence score calculation.
- Manual: verify metrics in UI and opt-in behavior.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-24 | v0.1 | New story for quality metrics | PO |

## Dev Agent Record
### Agent Model Used
GPT-5.2-Codex

### Debug Log References
N/A

### Completion Notes List
- Extended history metrics for network latency, fallback reasons, and quality class.
- Exposed quality metrics and telemetry export in Diagnostics.

### File List
- main.js
- store.js
- dashboard.js
- dashboard.html

## QA Results

### Review Date: 2026-02-01

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
Review based on story documentation and file list (main.js, store.js, dashboard.js, dashboard.html). Manual verification is noted; automated QA execution not recorded. Telemetry metrics and divergence score calculations.

### Refactoring Performed
None.

### Compliance Check
- Coding Standards: ✓ (per dev DoD; not re-verified in this pass; standards in docs/architecture/coding-standards.md)
- Project Structure: ✓ (file list confined to existing structure)
- Testing Strategy: ✗ (manual verification only; no automated coverage observed)
- All ACs Met: ✓ (per dev notes; not independently verified)

### Improvements Checklist

- [ ] Add unit tests for divergence score and metric rollups.
- [ ] Add opt-in gating tests for metrics emission.
- [ ] Add regression test for UI metric display.

### Security Review
Telemetry remains opt-in; verify no PII in metrics.

### Performance Considerations
Metric calculations should be light; verify with large histories.

### Files Modified During Review
None (QA artifacts only).

### Gate Status
Gate: CONCERNS -> docs/qa/gates/10.2-telemetry-and-quality-metrics.yml
Risk profile: Not run
NFR assessment: Not run

### Recommended Status
[✗ Changes Required - See unchecked items above]
(Story owner decides final status)
