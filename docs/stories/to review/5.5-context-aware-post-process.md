# Epic 5 — Context-Aware Post-Process

## Status
Ready for Review

## Story
**As a** user,
**I want** the post-process to use redacted context hints,
**so that** proper nouns are corrected more accurately without privacy surprises.

## Acceptance Criteria
1. When context capture is enabled and context-aware post-process is on, the post-process prompt includes redacted app/window/url hints.
2. When context capture is disabled or context-aware post-process is off, no context hints are sent.
3. Redaction applies to app/window/url before any OpenAI request (emails, phones, long numbers).
4. A global toggle in the Context view enables/disables context-aware post-process.
5. Context capture failures do not block post-process.

## Tasks / Subtasks
- [x] Add context-aware post-process toggle to settings/UI (AC: 4)
- [x] Inject redacted context hints into post-process prompt (AC: 1,2,3,5)

## Dev Notes
- Use only app/window/url signals as hints (no ax/textbox/screenshot).
- Keep hints short (truncate long titles, use URL domain only).
- Reuse existing redaction rules and never send raw context.

### Testing
- Manual: toggle on/off and verify behavior remains stable; disable context and confirm no context is used.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-25 | v0.1 | New story for context-aware post-process | PO |

## Dev Agent Record
### Agent Model Used
GPT-5

### Debug Log References
N/A

### Completion Notes List
- Added global toggle for context-aware post-process in Context view.
- Injects redacted app/window/url hints into post-process prompt when enabled.
- Extended redaction to app/window titles and trimmed URL hints to domains.

### File List
- main.js
- dashboard.html
- dashboard.js

## QA Results

### Review Date: 2026-02-01

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
Review based on story documentation and file list (main.js, dashboard.html, dashboard.js). Manual verification is noted; automated QA execution not recorded. Context-aware post-process with user toggle and opt-out paths.

### Refactoring Performed
None.

### Compliance Check
- Coding Standards: ✓ (per dev DoD; not re-verified in this pass; standards in docs/architecture/coding-standards.md)
- Project Structure: ✓ (file list confined to existing structure)
- Testing Strategy: ✗ (manual verification only; no automated coverage observed)
- All ACs Met: ✓ (per dev notes; not independently verified)

### Improvements Checklist

- [ ] Add tests for opt-in/out and context-disabled paths.
- [ ] Add privacy/PII redaction tests for context usage.
- [ ] Add regression coverage for stability when context is missing.

### Security Review
Context usage is privacy-sensitive; require opt-in and redaction verification.

### Performance Considerations
Post-process adds latency; measure impact on long dictations.

### Files Modified During Review
None (QA artifacts only).

### Gate Status
Gate: CONCERNS -> docs/qa/gates/5.5-context-aware-post-process.yml
Risk profile: Not run
NFR assessment: Not run

### Recommended Status
[✗ Changes Required - See unchecked items above]
(Story owner decides final status)
