# Paywall Enforcement and Upgrade CTA - Brownfield Addition

## User Story
As a user,
I want a clear paywall when I reach my quota,
So that I can choose to upgrade to PRO.

## Story Context

**Existing System Integration:**

- Integrates with: dictation pipeline gating + UI surfaces
- Technology: Electron (main/renderer), JS, Supabase auth
- Follows pattern: existing status/error messages and CTA buttons
- Touch points: transcription start/stop handlers, quota status check, UI paywall surface

## Acceptance Criteria

**Functional Requirements:**

1. When weekly quota is reached, dictation is blocked (hard limit) with a paywall message in the UI.
2. Paywall includes a clear Upgrade CTA and indication of remaining quota (0 words).
3. User remains logged in and can access non-dictation features.

**Integration Requirements:**
4. No regression in dictation when quota is not reached.
5. Paywall respects current UI patterns (buttons, colors, layout).
6. Integration with Supabase user identity remains intact for quota checks.

**Quality Requirements:**
7. Change is covered by appropriate tests or manual verification steps.
8. Documentation is updated if needed (PRD/story refs).
9. No regression in existing functionality verified.

## Technical Notes

- **Integration Approach:** Gate dictation in both UI and main process based on computed quota status; show paywall UI when blocked.
- **Existing Pattern Reference:** Current status banners and CTA button styles.
- **Key Constraints:** Hard limit only; no partial dictation beyond quota.

## Definition of Done

- [ ] Functional requirements met
- [ ] Integration requirements verified
- [ ] Existing functionality regression tested
- [ ] Code follows existing patterns and standards
- [ ] Tests pass (existing and new)
- [ ] Documentation updated if applicable

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Over-blocking users due to incorrect quota state.
- **Mitigation:** Use a single source of truth for quota state and add visible diagnostics.
- **Rollback:** Disable paywall gating and keep UI notice only.

**Compatibility Verification:**

- [ ] No breaking changes to existing APIs
- [ ] Database changes (if any) are additive only
- [ ] UI changes follow existing design patterns
- [ ] Performance impact is negligible

## Validation Checklist

**Scope Validation:**

- [ ] Story can be completed in one development session
- [ ] Integration approach is straightforward
- [ ] Follows existing patterns exactly
- [ ] No design or architecture work required

**Clarity Check:**

- [ ] Story requirements are unambiguous
- [ ] Integration points are clearly specified
- [ ] Success criteria are testable
- [ ] Rollback approach is simple
