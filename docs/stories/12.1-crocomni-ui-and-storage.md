# Epic 12 — CrocOmni UI and Storage

## Status
Ready for Review

## Story
**As a** user,
**I want** a CrocOmni assistant with conversation history,
**so that** I can revisit and continue my assistant sessions.

## Acceptance Criteria
1. CrocOmni has a GPT-like chat UI with user/assistant roles.
2. Chat supports streaming tokens and a “thinking” state for assistant responses.
3. Chat history persists locally across restarts.
4. A Clear button resets the chat.
5. A max-token cap is enforced for persisted chat context (drop oldest messages when over the cap; default: 4,000 tokens).
6. Typography hierarchy is readable: labels like “Source”, filters, and metadata are visually de-emphasized vs the main answer.
7. Messages can be added without requiring context capture (context is optional per Story 12.2).

## Tasks / Subtasks
- [x] Add CrocOmni conversation storage (local SQLite) (AC: 3)
- [x] Add CrocOmni UI in the hub (AC: 1,3)
- [x] Implement conversation list + detail view (AC: 1,3)
- [x] Wire message send/receive to existing AI provider (AC: 7)
- [x] Add streaming tokens + “thinking” state in chat UI (AC: 2)
- [x] Add Clear button to reset chat (AC: 4)
- [x] Enforce token cap for persisted chat context (default 4,000 tokens; drop oldest) (AC: 5)
- [x] Adjust CrocOmni typography hierarchy (AC: 6)

## Dev Notes
- Use a dedicated table: crocomni_history(conversation_id, role, content, created_at) and a conversations table for titles/archival.
- Context injection, opt-in controls, and redaction are handled in Story 12.2.

### Testing
- Manual: create conversation, continue, archive, verify persistence after restart.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-24 | v0.1 | Split CrocOmni UI/storage from context injection | PO |
| 2026-02-01 | v0.2 | Video review: GPT-like chat UX + streaming + clear + token cap + typography | PM |
| 2026-02-01 | v0.3 | Implemented CrocOmni chat streaming, clear, token cap, and typography updates | Dev |
| 2026-02-01 | v0.4 | CrocOmni chat now pulls local notes/history sources | Dev |

## Dev Agent Record
### Agent Model Used
GPT-5.2-Codex

### Debug Log References
N/A

### Completion Notes List
- Added CrocOmni storage tables with conversation list and message view.
- Wired message send/receive to OpenAI with local persistence.
- Built CrocOmni chat UI with conversation list, composer, and streaming updates.
- Added clear conversation action and token-cap pruning for persisted history.
- Updated typography hierarchy for chat metadata and labels.
- Added local notes/history source retrieval for CrocOmni responses.

### File List
- main.js
- store.js
- dashboard.js
- dashboard.html
- preload.js

## QA Results
