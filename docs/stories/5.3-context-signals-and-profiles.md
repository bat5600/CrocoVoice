# Epic 5 - Context Signals and Profiles

## Status
InProgress

## Story
**As a** user,
**I want** the app to detect what I am currently using and apply a matching context profile,
**so that** my dictation is formatted appropriately without manual setup each time.

## Acceptance Criteria
1. The app can detect the active app/window and bundle ID using accessibility permissions on supported OSes.
2. A context profile exists for each supported app, with configurable tone, formatting, and vocabulary hints.
3. If the active app has no profile or permissions are missing, the app falls back to default behavior.
4. Users can create, edit, and delete app profiles, and changes persist locally.
5. Profile selection is deterministic and debuggable (simple rule: bundle ID or window title match, optional URL domain match).
6. Context capture results are cached for the duration of a dictation session and reused across partials.
7. “App profiles” are explained in-product (what they do, when to use them) and are hidden/de-emphasized if they add confusion.
8. Any “test rapide / choose a profile” UX is removed or hidden until the value proposition is clear.

## Tasks / Subtasks
- [x] Implement active app/window detection and expose it to the UI (AC: 1,5)
- [x] Define context profile schema and storage (AC: 2,4)
- [x] Add basic profile management UI (list/edit/create/delete) (AC: 4)
- [x] Apply profile selection and fallback rules (AC: 3,5)
- [x] Add in-session context cache to avoid repeated OS calls (AC: 6)
- [ ] Improve Profiles UX: add clear explanation + hide/defer confusing flows (“test rapide / choose a profile”) (AC: 7,8)

## Dev Notes
- Prefer local-only storage for profiles (no network dependency).
- Keep detection logic simple; avoid brittle heuristics.
- Use existing settings patterns for persistence and UI layout.
- Store a normalized `context_id` (e.g., bundle ID + url domain) for matching.

### Testing
- Manual: switch between two apps with distinct profiles and verify applied settings.
- Manual: remove permissions and confirm fallback behavior with clear messaging.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-20 | v0.1 | Story created from global PRD Epic 5 shard plan | PO |
| 2026-02-01 | v0.2 | Video review: profiles UX is unclear; hide/defer and explain | PM |

## Dev Agent Record
### Agent Model Used
GPT-5

### Debug Log References
N/A

### Completion Notes List
- Détection app/fenêtre avec cache de session et sélection de profil déterministe.
- UI de profils (CRUD) + overrides et suggestion.

### File List
- main.js
- dashboard.html
- dashboard.js

## QA Results
